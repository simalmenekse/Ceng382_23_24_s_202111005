@page
@model JoinedChallengesModel
@{
    ViewData["Title"] = "Joined Challenges";

    var imagePaths = new List<string>
{
"/joined_photo_pool/1.jpg",
"/joined_photo_pool/2.jpg",
"/joined_photo_pool/3.jpg",
"/joined_photo_pool/4.jpg",
"/joined_photo_pool/5.jpg",
"/joined_photo_pool/6.jpg",
"/joined_photo_pool/7.jpg",
};

    var additionalImagePool = new List<string>
{
"/joined_photo_pool/dynamic_pool/1.jpg",
"/joined_photo_pool/dynamic_pool/2.jpg",
"/joined_photo_pool/dynamic_pool/3.jpg",
"/joined_photo_pool/dynamic_pool/4.jpg",
"/joined_photo_pool/dynamic_pool/5.jpg",
"/joined_photo_pool/dynamic_pool/6.jpg",
"/joined_photo_pool/dynamic_pool/7.jpg",
};
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

<head>
    <style>
        .additional-photo {
            margin-top: 140px;
        }
    </style>
</head>

<br>
<div class="album py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <h2 class="mb-4">Joined Challenges</h2>
                <a href="#" class="btn btn-info mb-2">
                    Completed Challenges: @Model.CompletedChallengesCount
                </a>
                <div class="mb-3">
                    @if (Request.Query["showFavorites"] == "true")
                    {
                        <a asp-page="./JoinedChallenges" class="btn btn-primary">Show All</a>
                    }
                    else
                    {
                        <a asp-page="./JoinedChallenges" asp-route-showFavorites="true" class="btn btn-primary">Show
                            Favorites</a>
                    }
                </div>

                <div class="row">
                    @foreach (var joinedChallenge in Model.JoinedChallenges)
                    {
                        var imagePath = imagePaths[joinedChallenge.Challenge.Id % imagePaths.Count];
                        <div class="col-md-6 mb-4">
                            <div class="card box-shadow">
                                <img class="card-img-top" src="@imagePath" alt="Card image cap">
                                <div class="card-body">
                                    <h3 class="card-title">@joinedChallenge.Challenge.Category</h3>
                                    <p class="card-text">Difficulty Level: @joinedChallenge.Challenge.DifficultyLevel</p>
                                    <p class="card-text">Period: @joinedChallenge.Challenge.Period</p>
                                    <p class="card-text">Join Date: @joinedChallenge.JoinDate.ToShortDateString()</p>
                                    <hr>
                                    <h4>Instructions:</h4>
                                    <p>@joinedChallenge.Challenge.Instructions</p>
                                    <div class="d-flex justify-content-between">
                                        @if (!joinedChallenge.IsCompleted)
                                        {
                                            <form id="completeForm_@joinedChallenge.Challenge.Id" method="post"
                                                asp-page-handler="ToggleCompletion"
                                                asp-route-challengeId="@joinedChallenge.Challenge.Id">
                                                <input type="hidden" name="challengeId" value="@joinedChallenge.Challenge.Id" />
                                                <button type="submit" class="btn btn-success">Mark as Completed</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <form id="uncompleteForm_@joinedChallenge.Challenge.Id" method="post"
                                                asp-page-handler="ToggleCompletion"
                                                asp-route-challengeId="@joinedChallenge.Challenge.Id">
                                                <input type="hidden" name="challengeId" value="@joinedChallenge.Challenge.Id" />
                                                <button type="submit" class="btn btn-secondary">Undo Completed</button>
                                            </form>
                                        }
                                        @if (joinedChallenge.IsFavorite)
                                        {
                                            <form id="unfavoriteForm_@joinedChallenge.Challenge.Id" method="post"
                                                asp-page-handler="ToggleFavorite"
                                                asp-route-challengeId="@joinedChallenge.Challenge.Id">
                                                <input type="hidden" name="challengeId" value="@joinedChallenge.Challenge.Id" />
                                                <button type="submit" class="btn btn-warning">Unfavorite</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <form id="favoriteForm_@joinedChallenge.Challenge.Id" method="post"
                                                asp-page-handler="ToggleFavorite"
                                                asp-route-challengeId="@joinedChallenge.Challenge.Id">
                                                <input type="hidden" name="challengeId" value="@joinedChallenge.Challenge.Id" />
                                                <button type="submit" class="btn btn-outline-primary">Mark as Favorite</button>
                                            </form>
                                        }
                                        <form id="leaveForm_@joinedChallenge.Challenge.Id"
                                            onsubmit="return confirmLeave(@joinedChallenge.Challenge.Id)"
                                            asp-page-handler="LeaveChallenge" handler="OnPostLeaveChallengeAsync"
                                            asp-route-challengeId="@joinedChallenge.Challenge.Id">
                                            <button type="submit" class="btn btn-danger">Leave Challenge</button>
                                            @Html.AntiForgeryToken()
                                        </form>

                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            @if (Model.JoinedChallenges.Count > 2)
            {
                <div class="col-md-4">
                    @for (var i = 2; i < Model.JoinedChallenges.Count; i++)
                    {
                        var challenge = Model.JoinedChallenges[i];
                        var imagePath = additionalImagePool[(i - 2) % additionalImagePool.Count];
                        <div class="card mb-3 box-shadow additional-photo">
                            <img class="card-img-top" src="@imagePath" alt="Additional Photo">
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

<script>
    function confirmLeave() {
        return confirm("Are you sure you want to leave this challenge?");
    }
</script>
